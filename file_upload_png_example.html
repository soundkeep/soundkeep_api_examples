<html>
  <head>
    <script src="/scripts/jquery.js"></script>
    <style>
      img { background: blue; }
    </style>
  </head>
  <body>
    <h1>File Upload Example Using PNG Waveform</h1>
    <input type="file" />

    <script>
      $('input').bind('change', function(e) {
        // get handle for the file
        var file = e.target.files[0];
        var type = $('.type').val();
        var bpm = $('.bpm').val();

        // create form
        var formData = new FormData();

        formData.append('apiKey', '$2a$10$nAheSfXghsMuAaGeN3qobeGq6actJcvh9jf/v6qEioMv4jE4pWw5u');

        // create track object
        track = {
          'name': file.name, // REQUIRED
          'type': type,  // options are 'stem', 'loop', or 'sample'. REQUIRED
          'bpm': 140, // OPTIONAL
          'key': 'C minor', // see options *below. OPTIONAL
          'tags': ['synth', 'electronica'] // OPTIONAL
        }

        // stringify track to json and attach to form data
        formData.append('track', JSON.stringify(track));

        // attach audio file to form data.  be sure to pass the third file.name argument
        formData.append('audio', file, file.name);
      
        // create xhr object
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'http://localhost:1337/upload', true);
        // xhr.withCredentials = true;

        // listen for when the file is done uploading
        xhr.onload = function(e) {
          console.log('hooray', e);
          var response = JSON.parse(this.response);
          console.log(response);
          $('body').append('<img src="http://waveforms.soundkeep.com/' + response.waveform + '">')
          $('body').append('<audio src="http://tracks.soundkeep.com/' + response.path + '" controls></audio>')
        };
      
        // Listen to the upload progress.
        // var progressBar = document.querySelector('progress');
        xhr.upload.onprogress = function(e) {
          if (e.lengthComputable) {
            console.log('progress', e);
            // progressBar.value = (e.loaded / e.total) * 100;
            // progressBar.textContent = progressBar.value; // Fallback for unsupported browsers.
          }
        }
      
        // send request
        xhr.send(formData);    
      });
    </script>
  </body>
</html>
